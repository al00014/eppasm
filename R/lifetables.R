## Wilmoth log-quad model coefficients, interpolated to single years age 15:80
lq1_m <- structure(c(-4.04457282388477, -4.00727212651382, -3.93740052043582,
                     -3.83789864673989, -3.72122258489754, -3.60220727397589, -3.49568765304204,
                     -3.4164986611631, -3.37526663820977, -3.36578352726702, -3.37763267222342,
                     -3.40039741696754, -3.42366110538792, -3.43909479248379, -3.44672037769698,
                     -3.44864747157996, -3.44698568468524, -3.44384462756528, -3.44085382381159,
                     -3.4377224491717, -3.43367959243216, -3.42795434237953, -3.41977578780034,
                     -3.4089150676643, -3.39731152167373, -3.3874465397141, -3.38180151167086,
                     -3.38285782742949, -3.39205733154806, -3.40668368727504, -3.42298101253153,
                     -3.43719342523859, -3.44556504331732, -3.44556661458321, -3.43957540642945,
                     -3.43119531614364, -3.42403024101339, -3.42168407832628, -3.42620897052247,
                     -3.4334500406523, -3.43770065691863, -3.43325418752434, -3.4144040006723,
                     -3.37733020218666, -3.32575984837667, -3.26530673317282, -3.20158465050564,
                     -3.14020739430562, -3.0851213238703, -3.03360305996525, -2.98126178872305,
                     -2.92370669627631, -2.8565469687576, -2.77689888844895, -2.68790712223014,
                     -2.59422343313034, -2.50049958417878, -2.41138733840464, -2.33028514622388,
                     -2.25557820759945, -2.18439840988107, -2.11387764041844, -2.04114778656127,
                     -1.96415372580453, -1.88409229622422, -1.80297332604157, 1.08293474337023,
                     1.05361165226085, 1.04247971314827, 1.05174057899351, 1.07596555360256,
                     1.10781835349266, 1.13996269518104, 1.16506229518495, 1.17751099705926,
                     1.17862315250941, 1.17144324027851, 1.15901573910963, 1.14438512774588,
                     1.12998389044994, 1.1157965335629, 1.10119556894545, 1.08555350845828,
                     1.06824286396208, 1.04885493766654, 1.0278561931773, 1.00593188444904,
                     0.983767265436395, 0.962047590094026, 0.941054733796526, 0.919457057598256,
                     0.895519543973518, 0.867507175396614, 0.833684934341847, 0.793015304337583,
                     0.747250773128445, 0.698841329513121, 0.650236962290297, 0.603887660258663,
                     0.561510271705905, 0.521889082875708, 0.483075239500758, 0.44311988731374,
                     0.400074172047341, 0.352835286597335, 0.303684612511856, 0.255749578502127,
                     0.212157613279374, 0.176036145554819, 0.149513737339349, 0.130723483842497,
                     0.116799613573463, 0.104876355041442, 0.0920879367556321, 0.0764235044624392,
                     0.0592918728571055, 0.0429567738720823, 0.0296819394398207, 0.0217311014927721,
                     0.0205495168781435, 0.0243085421021656, 0.0303610585858248, 0.0360599477501078,
                     0.038758091016001, 0.03656574855932, 0.0306226955751964, 0.0228260860135909,
                     0.0150730738244642, 0.00926081295777703, 0.0067487141916767,
                     0.00674521561705734, 0.00792101215299974, 0.0679513646587908,
                     0.071085497484796, 0.0749508953560368, 0.0793962355053619, 0.0840301001416253,
                     0.0884010477176826, 0.0920576366863892, 0.0945484255006006, 0.0955560334723572,
                     0.0952993233504386, 0.0941312187428094, 0.0924046432574341, 0.0904725205022772,
                     0.0886185849425595, 0.0868498144725268, 0.0851039978436814, 0.0833189238075255,
                     0.0814323811155612, 0.0794070851159, 0.0773054575430902, 0.0752148467282897,
                     0.073222601002656, 0.0714160686973468, 0.0698236934513528, 0.0682383001349963,
                     0.0663938089264329, 0.0640241400038177, 0.0608632135453063, 0.0567439327389574,
                     0.0518951328124432, 0.0466446320033396, 0.0413202485492223, 0.036249800687667,
                     0.0316623568686312, 0.0273919863915997, 0.023174008768439, 0.0187437435110158,
                     0.0138365101311965, 0.00830209124706054, 0.00244812190153836,
                     -0.00330329975622685, -0.00853007557709184, -0.0128101074119134,
                     -0.0158525658118977, -0.0178916961296488, -0.0192930124181198,
                     -0.0204220287302642, -0.0216442591190353, -0.0232158067901429,
                     -0.024955131560323, -0.0265712823990678, -0.0277733082758698,
                     -0.0282702581602213, -0.0278791331390728, -0.0268487427692073,
                     -0.0255358487248661, -0.0242972126802903, -0.023489596309721,
                     -0.0233644610333659, -0.0237520672552984, -0.0243773751255583,
                     -0.0249653447941854, -0.0252409364112197, -0.0250075365343721,
                     -0.0243822373520386, -0.0235605574602862, 0.190687827832027,
                     0.20230774735961, 0.216109468588607, 0.232014837203739, 0.249370812369499,
                     0.267380631620327, 0.28524753249066, 0.302174752514936, 0.317505812754497,
                     0.331145368378292, 0.343138358082173, 0.353529720561995, 0.362364394513608,
                     0.369687850540605, 0.375547686877537, 0.379992033666692, 0.38306902105036,
                     0.384826779170831, 0.385332929512332, 0.38473305892684, 0.38319224560827,
                     0.380875567750538, 0.377948103547558, 0.374519313296771, 0.37047618570972,
                     0.365650091601472, 0.359872401787096, 0.352974487081659, 0.344869655126518,
                     0.33579896086818, 0.326085396079441, 0.316051952533097, 0.306021622001942,
                     0.296230430838789, 0.286566543716516, 0.276831159888018, 0.266825478606189,
                     0.256350699123925, 0.24530151258287, 0.23394657767967, 0.222648044999721,
                     0.21176806512842, 0.201668788651162, 0.19260077108469, 0.184368187671135,
                     0.176663618583974, 0.169179643996683, 0.16160884408274, 0.153722850925375,
                     0.145609504246829, 0.137435695679096, 0.129368316854171, 0.121574259404048,
                     0.114171640452914, 0.107083479093727, 0.100184019911637, 0.0933475074917959,
                     0.0864481864193535, 0.079416783646609, 0.0724099555944543, 0.0656408410509298,
                     0.0593225788040756, 0.0536683076419322, 0.0488012131248851, 0.0444846679027011,
                     0.0403920913974927),
                   .Dim = c(66L, 4L), .Dimnames = list(NULL, c("ax_m", "bx_m", "cx_m", "vx_m")))

lq1_f <- structure(c(-3.20121258170136, -3.15658205488728, -3.1099288731249,
                     -3.06803612183411, -3.03302707424925, -3.00586005055826, -2.98749337094907,
                     -2.97888535560963, -2.9802162526794, -2.988554022104, -3.00018855178057,
                     -3.01140972960627, -3.01850744347823, -3.01903384785931, -3.01559016347521,
                     -3.0120398776173, -3.01224647757699, -3.02007345064568, -3.0381043121713,
                     -3.06380268972801, -3.0933522389465, -3.12293661545746, -3.1487394748916,
                     -3.16839679428629, -3.18535383630562, -3.2045081850204, -3.2307574245014,
                     -3.2689991388194, -3.32180057527443, -3.38240763408341, -3.44173587869254,
                     -3.49070087254797, -3.52021817909588, -3.52399939746553, -3.50694026951852,
                     -3.47673257279953, -3.44106808485325, -3.40763858322437, -3.38185937847431,
                     -3.36003991323146, -3.33621316314097, -3.30441210384798, -3.25866971099761,
                     -3.19524886106959, -3.11933203388196, -3.03833161008733, -2.95965997033831,
                     -2.89072949528753, -2.83662614935521, -2.793130232032, -2.75369562657618,
                     -2.71177621624601, -2.66082588429976, -2.59632587523732, -2.52186687852511,
                     -2.44306694487115, -2.36554412498348, -2.29491646957014, -2.23519863715989,
                     -2.18399171756441, -2.1372934084161, -2.09110140734738, -2.04141341199065,
                     -1.98526989588801, -1.92388243622037, -1.85950538607832, 1.60920570115918,
                     1.59365207477189, 1.5797313207243, 1.56723811169693, 1.55498491916739,
                     1.54153866431258, 1.52546626830938, 1.5053346523347, 1.48034514094173,
                     1.45223667218892, 1.42338258751106, 1.39615622834291, 1.37293093611924,
                     1.35518381332265, 1.34080700662705, 1.32679642375417, 1.31014797242574,
                     1.28785756036351, 1.25788480748932, 1.22204418252548, 1.18311386639442,
                     1.14387204001855, 1.1070968843203, 1.07457848420188, 1.0441545404846,
                     1.01267465796959, 0.976988441457936, 0.933945495750759, 0.881724398776308,
                     0.823819620971416, 0.765054605900062, 0.710252797126224, 0.66423763821388,
                     0.630398732283421, 0.606390320680881, 0.588432804308705, 0.572746584069339,
                     0.55555206086523, 0.534120954275889, 0.509930258589097, 0.485508286769701,
                     0.463383351782547, 0.446083766592483, 0.435164840634852, 0.428289869226982,
                     0.4221491441567, 0.413432957211829, 0.398831600180196, 0.376134125960409,
                     0.347524631894212, 0.316285976434131, 0.285701018032696, 0.259052615142433,
                     0.238633037716948, 0.22277220171416, 0.208809434593066, 0.194084063812664,
                     0.175935416831952, 0.152561704434491, 0.125596670702101, 0.0975329430411646,
                     0.0708631488580662, 0.0480799155591892, 0.0309870550371262, 0.0186331171293057,
                     0.00937783615936532, 0.113744805663479, 0.114648626163677, 0.114700047874228,
                     0.113685769954924, 0.111678504723587, 0.108822467787542, 0.105261874754118,
                     0.101140941230641, 0.0966387400371019, 0.0920737728441454, 0.0877993985350799,
                     0.0841689759932138, 0.0815358641018554, 0.0801102948341126, 0.0795299925222916,
                     0.0792895545884981, 0.0788835784548379, 0.0778066615434165, 0.0757058028984833,
                     0.0728376080528615, 0.069611084161518, 0.0664352383794194, 0.0637190778615326,
                     0.0617269359850262, 0.0601444510158764, 0.0585125874422611, 0.0563723097523582,
                     0.0532645824343458, 0.0489047105997839, 0.0437053618537611, 0.038253544424748,
                     0.0331362665412154, 0.028940536431634, 0.0260813303816982, 0.0242854969059974,
                     0.0231078525763451, 0.0221032139645544, 0.0208263976424387, 0.0189550805873151,
                     0.016658381398516, 0.014228279080878, 0.0119567526392374, 0.0101357810784305,
                     0.00894658862809559, 0.00812738041707808, 0.0073056067990252,
                     0.00610871812758421, 0.00416416475640234, 0.00123026317078559,
                     -0.00241120561732505, -0.00634759446432984, -0.010166256226629,
                     -0.0134545437606229, -0.0159226842524328, -0.0177724022070646,
                     -0.0193282964592452, -0.0209149658437016, -0.0228570091951607,
                     -0.0253679421001723, -0.028216947152577, -0.0310621236980382,
                     -0.0335615710822194, -0.0353733886507841, -0.0362562020830092,
                     -0.0363707423926258, -0.0359782669269789, 0.381242410015622,
                     0.39190506450947, 0.400651352065886, 0.407135111640108, 0.411444580075544,
                     0.413776593687645, 0.414327988791864, 0.413295601703652, 0.410853189993274,
                     0.407082196250252, 0.402040984318924, 0.395787918043625, 0.388381361268693,
                     0.379903845268332, 0.370534571036217, 0.360476906995892, 0.349934221570899,
                     0.339109883184782, 0.328167262699358, 0.317109740729541, 0.305900700328518,
                     0.294503524549478, 0.282881596445607, 0.271034321386212, 0.25910519400507,
                     0.247273731252078, 0.23571945007713, 0.224621867430123, 0.214121787892579,
                     0.204205166572525, 0.194819246209615, 0.185911269543503, 0.177428479313842,
                     0.169344838284016, 0.161741189312324, 0.154725095280796, 0.148404119071461,
                     0.142885823566349, 0.13818094085014, 0.133912879818113, 0.1296082185682,
                     0.12479353519833, 0.118995407806435, 0.111916189059642, 0.103961329901865,
                     0.0957120558462155, 0.0877495924058053, 0.0806551650937455, 0.0748385677650383,
                     0.0700238676422492, 0.0657637002898345, 0.0616107012722504, 0.0571175061539533,
                     0.0519612603518742, 0.0463171486928431, 0.0404848658561647, 0.0347641065211438,
                     0.0294545653670851, 0.0247909958175161, 0.0207483862728557, 0.0172367838777452,
                     0.0141662357768263, 0.0114467891147405, 0.00901482311033419,
                     0.00691204527927337, 0.00520649521142891),
                   .Dim = c(66L, 4L), .Dimnames = list(NULL, c("ax_f", "bx_f", "cx_f", "vx_f")))

lq1 <- rbind(lq1_m, lq1_f)

h_m <- log(0.1) + -10:10*0.1
h_f <- log(0.1) + -10:10*0.1
v_m <- 0
v_f <- 0

## Note: age groups 15:80 are hard coded
logquad_mx <- function(h_m, v_m, h_f, v_f){

  Xm <- rbind(1, h_m, h_m^2, v_m)
  Xf <- rbind(1, h_f, h_f^2, v_f)

  mx_m <- exp(lq1_m %*% Xm)
  mx_f <- exp(lq1_f %*% Xf)

  mx <- rbind(mx_m, mx_f)
  dim(mx) <- c(66, 2, ncol(mx))

  return(mx)
}

## Note: age groups 15:80 are hard coded
logquad_nqx <- function(h_m, v_m, h_f, v_f, n=45, x=15){
  mx <- logquad_mx(h_m, v_m, h_f, v_f)
  return(1-exp(-colSums(mx[x-15+1:n,,])))
}
